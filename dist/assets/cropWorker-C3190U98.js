(function(){"use strict";self.onmessage=async u=>{const{imageDataUrl:f,sourceX:l,sourceY:g,sourceWidth:a,sourceHeight:s,outputWidth:t,outputHeight:o,outputFormat:m,quality:w,filename:r}=u.data;try{const e=await fetch(f);if(!e.ok)throw new Error(`Failed to fetch image: ${e.status}`);const p=await e.blob(),c=await createImageBitmap(p);if(a<=0||s<=0||t<=0||o<=0)throw new Error("Invalid crop dimensions received by worker.");const n=new OffscreenCanvas(t,o),i=n.getContext("2d");if(!i)throw new Error("Failed to get 2D context from OffscreenCanvas");i.drawImage(c,l,g,a,s,0,0,t,o),c.close();const d=await n.convertToBlob({type:m,quality:w});self.postMessage({status:"cropped",blob:d,filename:r})}catch(e){console.error("Worker error for",r,":",e),self.postMessage({status:"error",error:e.message,filename:r})}}})();
